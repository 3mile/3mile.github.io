<!DOCTYPE html>
<html lang="zh-cn">
<head>

  <meta charset="utf-8" />

  
  <title>Linux开放HTTP服务并下载文件到本地以测试VPS回程速度</title>

  
  





  
  <meta name="author" content="3mile" />
  <meta name="description" content="内容 在 Linux中使用 路由追踪 测试VPS回程路由（回程路由比去程更影响SS速度） 文章中，我说过如果你的服务器是做代理的，那么最影响速度的就是" />

  
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@3mile1" />
    <meta name="twitter:title" content="Linux开放HTTP服务并下载文件到本地以测试VPS回程速度" />
    <meta name="twitter:description" content="内容 在 Linux中使用 路由追踪 测试VPS回程路由（回程路由比去程更影响SS速度） 文章中，我说过如果你的服务器是做代理的，那么最影响速度的就是" />
    <meta name="twitter:image" content="https://3mile.github.io/img/avatar.jpg" />
  

  
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Linux开放HTTP服务并下载文件到本地以测试VPS回程速度" />
  <meta property="og:description" content="内容 在 Linux中使用 路由追踪 测试VPS回程路由（回程路由比去程更影响SS速度） 文章中，我说过如果你的服务器是做代理的，那么最影响速度的就是" />
  <meta property="og:url" content="https://3mile.github.io/archives/103/" />
  <meta property="og:image" content="https://3mile.github.io/img/avatar.jpg" />




<meta name="generator" content="Hugo 0.37.1" />


<link rel="canonical" href="https://3mile.github.io/archives/103/" />
<link rel="alternative" href="https://3mile.github.io/index.xml" title="3mile博客" type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="FMb4P3vZ2uji_L-ttr7e2a22spQhPVCofJ_d3Vwx220" />
<meta name="msvalidate.01" content="22596E34341DD1D17D6022C44647E587" />
<meta name="baidu-site-verification" content="LN2gf0A8Hs" />




<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="3mile博客" />
<meta name="msapplication-tooltip" content="3mile博客" />
<meta name='msapplication-navbutton-color' content="#5fbf5e" />
<meta name="msapplication-TileColor" content="#5fbf5e" />
<meta name="msapplication-TileImage" content="/img/tile-image-windows.png" />
<link rel="icon" href="https://3mile.github.io/img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="https://3mile.github.io/img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://3mile.github.io/img/favicon-32x32.png" />
<link rel="icon" sizes="192x192" href="https://3mile.github.io/img/touch-icon-android.png" />
<link rel="apple-touch-icon" href="https://3mile.github.io/img/touch-icon-apple.png" />
<link rel="mask-icon" href="https://3mile.github.io/img/safari-pinned-tab.svg" color="#5fbf5e" />



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

<link rel="stylesheet" href="https://3mile.github.io/css/bundle.css" />


  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.8/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.4/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="https://3mile.github.io/img/avatar.jpg" alt="Avatar">
  
  <h2 class="title">3mile博客</h2>
  
  <p class="subtitle">~ 学习,总是使人进步 ~</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
            
            
            
              is-active
            ">
            <a href="https://3mile.github.io/">主页</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://github.com/3mile">Works</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://3mile.github.io/categories/">分类</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://3mile.github.io/tags/">标签</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://3mile.github.io/about/">关于</a>
          </li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list">

      
      <li class="social-item">
        <a href="mailto:mile3@live.com" title="Email"><span class="icon icon-email"></span></a>
      </li>

      
      <li class="social-item">
        <a href="//github.com/3mile" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      <li class="social-item">
        <a href="//twitter.com/3mile1" title="Twitter"><span class="icon icon-twitter"></span></a>
      </li>

      <li class="social-item">
        <a href="//www.facebook.com/mile3033" title="Facebook"><span class="icon icon-facebook"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="//weibo.com/3179328351" title="Weibo"><span class="icon icon-weibo"></span></a>
      </li>

      <li class="social-item">
        <a href="https://3mile.github.io/img/qrcode.jpg" title="Wechat"><span class="icon icon-wechat"></span></a>
      </li>

      <li class="social-item">
        <a href="//www.linkedin.com/in/" title="Linkedin"><span class="icon icon-linkedin"></span></a>
      </li>

      

      

      

      <li class="social-item">
        <a href="https://3mile.github.io/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">Linux开放HTTP服务并下载文件到本地以测试VPS回程速度</h1>
      <p class="post-meta">@3mile · Apr 2, 2018 · 4 min read</p>
    </header>
    <article class="post-content">

<p><font color=red>内容</font></p>

<p>在 <a href="https://doub.io/linux-jc4/">Linux中使用 路由追踪 测试VPS回程路由（回程路由比去程更影响SS速度）</a> 文章中，我说过如果你的服务器是做代理的，那么最影响速度的就是回程路由质量，那个文章中教你如何通过路由追踪测试VPS回程路由质量，但是毕竟路由质量不代表最终速度，而现在这篇文章就是让你测试，你在下载VPS上面的文件到本地的速度(回程速度)。</p>

<hr />

<p>大部分情况下，你挂代理比如Shadowsocks&reg;，大部分情况下你都是在下载数据(VPS传给你)，无论是看视频还是看网页。所以这个速度才是最终影响你体验的指数。</p>

<p>而如何测试呢？很简单，只要在VPS上面开放HTTP服务，然后在VPS开放的文件夹中下载一个 100MB的测试文件，然后我们从浏览器打开并下载这个 100MB的测试文件，在下载期间看文件的下载速度。</p>

<p>当然这篇文章不仅限于，测试VPS回程速度，有时候你需要开放/共享 VPS上的一些文件，你也可以看这篇文章。</p>

<hr />

<p>搭建HTTP服务有很多方法，但是我们只是测试一下VPS上面的文件下载到本地的速度，所以要排除那些步骤复杂，设置颇多的HTTP工具。</p>

<p>所以这里我选择了：<strong>SimpleHTTPServer 和 Caddy</strong> （注意：只需要选择其中一个就行了！</p>

<h2 id="simplehttpserver">SimpleHTTPServer</h2>

<p>SimpleHTTPServer是Pyhton自带的一个简易HTTP Server，所以要使用这个工具，VPS中要安装的有 Python，优点是大部分Linux系统中都会安装 Python。</p>

<blockquote>
<p><strong>缺点：</strong>经过逗比们反馈，SimpleHTTPServer似乎存在 <strong>下载速度不稳定/很慢</strong> 的问题，而且不支持多线程下载，如果觉得不好用，请看Caddy。</p>
</blockquote>

<h3 id="检查python是否安装">检查Python是否安装：</h3>

<pre><code>python -V# 正常情况下应该返回 Python 2.7.x # 如果返回命令找不到 python: command not found ，那么说明没有安装Python。
</code></pre>

<p>如果没有安装，那么请<strong>安装 Python：</strong></p>

<pre><code># CentOS 系统：yum update &amp;&amp; yum install python python2.7 -y # Debian/Ubuntu 系统：apt-get update &amp;&amp; apt-get install python python2.7 -y# 安装后使用 python -V 查看是否安装成功，如果不成功就去谷歌吧！
</code></pre>

<hr />

<p>确认Python安装正常后，就可以看下面这个教程继续操作了，很早就写过，当时还写了一个一键脚本。</p>

<ul>
<li><a href="https://doub.io/wlzy-8/">『原创』SimpleHTTPServer 快速搭建HTTP Web服务 + 一键脚本</a></li>
</ul>

<p>在使用 SimpleHTTPServer 开放HTTP服务后，<strong>进入你开放HTTP服务的文件夹内</strong>，然后生成一个 100MB的测试文件。</p>

<pre><code>dd if=/dev/zero of=Test bs=1M count=100# 100MB文件太小，测试不过瘾？那只需要把最后的数字改成你想要的，比如 500=500MBdd if=/dev/zero of=Test bs=1M count=500# Test就是生成的测试文件的文件名，1M是每次写入1M大小，500是写入500次，也就是名为Test的500MB大小文件。
</code></pre>

<p>最后，我们打开<code>http://VPS_IP:端口</code>即可看到虚拟主机文件夹内的文件了，开始下载名为 Test的文件测速吧！</p>

<h3 id="卸载-simplehttpserver">卸载 SimpleHTTPServer：</h3>

<p>SimpleHTTPServer是集成与 Python的，所以无法卸载，只需要把脚本（如果用的话）和下载测速的文件删除即可。</p>

<pre><code>rm -rf Test
</code></pre>

<h2 id="caddy">Caddy</h2>

<p>Caddy是一个Go语言编写的很简单的 HTTP Server，配置文件异常简单，相比于 SimpleHTTPServer 的不稳定和不支持多线程，Caddy更适合长期使用，当然不代表不适合短期使用。</p>

<h3 id="部署方法">部署方法：</h3>

<pre><code>wget -N --no-check-certificate https://softs.fun/Bash/caddy_install.sh &amp;&amp; chmod +x caddy_install.sh &amp;&amp; bash caddy_install.sh install http.filemanager # 如果上面这个脚本无法下载，尝试使用备用下载：wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/caddy_install.sh &amp;&amp; chmod +x caddy_install.sh &amp;&amp; bash caddy_install.sh install http.filemanager
</code></pre>

<p>安装Caddy成功后，继续新建一个虚拟主机文件夹，</p>

<pre><code>mkdir /usr/local/caddy/www &amp;&amp; mkdir /usr/local/caddy/www/speeder
</code></pre>

<h3 id="写入配置文件">写入配置文件</h3>

<p>写入配置到 Caddy 配置文件，注意下面这六行要一起复制粘贴，不是一行一行复制！</p>

<pre><code># 以下全部内容是一个整体，是一个命令，全部复制粘贴到SSH软件中并一起执行！echo &quot;:80 { root /usr/local/caddy/www/speeder timeouts none gzip browse}&quot; &gt; /usr/local/caddy/Caddyfile# 如果要绑定域名，只要把上面第一行的[ :80 { ]改成域名比如[ http://tooyo.ml { ]即可(不需要加端口号了)#
</code></pre>

<p>上面的代码执行完后，启动 Caddy即可。</p>

<pre><code>/etc/init.d/caddy start
</code></pre>

<h3 id="下载测速文件">下载测速文件</h3>

<p>然后我们进入 虚拟主机文件夹，并下载 测速文件：</p>

<pre><code>cd /usr/local/caddy/www/speederdd if=/dev/zero of=Test bs=1M count=100# 100MB文件太小，测试不过瘾？那只需要把最后的数字改成你想要的，比如 500=500MBdd if=/dev/zero of=Test bs=1M count=500# Test就是生成的测试文件的文件名，1M是每次写入1M大小，500是写入500次，也就是名为Test的500MB大小文件。
</code></pre>

<p>最后，我们打开<code>http://VPS_IP</code>即可看到虚拟主机文件夹内的文件了，开始下载名为 Test的文件测速吧！</p>

<h3 id="caddy-使用方法">Caddy 使用方法</h3>

<p><strong>启动：</strong>/etc/init.d/caddy start</p>

<p><strong>停止：</strong>/etc/init.d/caddy stop</p>

<p><strong>重启：</strong>/etc/init.d/caddy restart</p>

<p><strong>查看状态：</strong>/etc/init.d/caddy status</p>

<h3 id="卸载-caddy">卸载 Caddy</h3>

<p>进入你下载caddy安装脚本的文件夹，并用下面代码运行脚本即可完全卸载。</p>

<pre><code>bash caddy_install.sh uninstall
</code></pre>

<h3 id="启动显示成功-但是实际未运行">启动显示成功，但是实际未运行</h3>

<p>因为 服务脚本判断的问题，只判断了nohub是否运行 Caddy成功，但没有判断 Caddy 是否保持正常运行。</p>

<p>你可以理解为，nohub成功启动了 Caddy，但是 Caddy因为配置文件错误等原因，启动后又退出了。</p>

<p>所以这种情况下，你应该去查看启动日志：</p>

<pre><code>tail -f /tmp/caddy.log
</code></pre>
</article>
    <footer class="post-footer">
      
      <p class="post-copyright">
        
      </p>
    </footer>
    
      
    
  </section>
  <footer class="site-footer">
  <p>© 2017-2018 3mile博客</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank">Nuo</a>.</p>
  
</footer>



<script async src="//cdn.bootcss.com/video.js/6.2.8/alt/video.novtt.min.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>

<script src="https://3mile.github.io/js/bundle.js"></script>




  </body>
</html>
